---
description: Defines where to place model classes - reusable layers go in physicsnemo/nn, complete models go in physicsnemo/models, with exceptions for example-specific code.
alwaysApply: false
---

When generating or refactoring model code, rule MOD-000 must be followed.
Explicitly reference the rule ID MOD-000 and quote relevant sections when
explaining placement decisions. For example: "Following rule MOD-000, which
states that reusable layers should go in physicsnemo/nn, this
reusable layer should be placed in physicsnemo/nn/..."

## MOD-000: Models organization and where to place new model classes

**Description:**

There are two types of models in PhysicsNeMo:

- Reusable layers that are the building blocks of more complex architectures.
  Those should go into `physicsnemo/nn`. Those include for instance
  `FullyConnected`, various variants of attention layers, `UNetBlock` (a block
  of a U-Net), etc.
  All layers that are directly exposed to the user should be imported in
  `physicsnemo/nn/__init__.py`, such that they can be used as follows:
  ```python
  from physicsnemo.nn import MyLayer
  ```
- More complete models, composed of multiple layers and/or other sub-models.
  Those should go into `physicsnemo/models`. All models that are directly
  exposed to the user should be imported in `physicsnemo/models/__init__.py`,
  such that they can be used as follows:
  ```python
  from physicsnemo.models import MyModel
  ```

The only exception to this rule is for models or layers that are highly specific to a
single example. In this case, it may be acceptable to place them in a module
specific to the example code, such as for example
`examples/<example_name>/utils/nn.py`.

**Rationale:**
Ensures consistency and clarity in the organization of models in the
repository, in particular a clear separation between reusable layers and more
complete models that are applicable to a specific domain or specific data
modality.

**Example:**

```python
# Good: Reusable layer in physicsnemo/nn/attention.py
class MultiHeadAttention(Module):
    """A reusable attention layer that can be used in various architectures."""
    pass

# Good: Complete model in physicsnemo/models/transformer.py
class TransformerModel(Module):
    """A complete transformer model composed of attention and feedforward layers."""
    def __init__(self):
        super().__init__()
        self.attention = MultiHeadAttention(...)
        self.ffn = FeedForward(...)

# Good: Example-specific utility in examples/weather/utils/nn.py
class WeatherSpecificLayer(Module):
    """Layer highly specific to the weather forecasting example."""
    pass
```

**Anti-pattern:**

```python
# WRONG: Complete model placed in physicsnemo/nn/ instead of physicsnemo/models/
# File: physicsnemo/nn/transformer.py
class TransformerModel(Module):
    """Should be in physicsnemo/models/ not physicsnemo/nn/"""
    pass

# WRONG: Reusable layer placed in physicsnemo/models/ instead of physicsnemo/nn/
# File: physicsnemo/models/attention.py
class MultiHeadAttention(Module):
    """Should be in physicsnemo/nn/ not physicsnemo/models/"""
    pass
```
